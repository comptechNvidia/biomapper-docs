# Generation Change Flow

### Humanode OAuth 2 Service

The whole instance gets deleted and a new one gets deployed. This includes CVM itself and OAuth 2 code. Newly generated OAuth 2 Client parameters will be used for a new signer server.

### Signer Server

In order to update the signer server, a new private signer server key is generated. Signer Server address is derived from this key. This address will not be used as a wallet address on-chain, but rather to validate the signature.

Being an off-chain part of Humanode Biomapper, signer server gets redeployed with new parameters, such as signer server private key and OAuth 2 Client parameters.

The reason behind updating the signer server is to invalidate previous generation signatures to prevent potential Sybil attacks.

### Smart Contracts

#### **`Biomapper` contract**

`Biomapper` contract does not operate with the concept of Biometric generations, but rather always works in a current generation.

On each generation, the following steps are taken:

1. a new `SwappableStorage` contract is deployed
2. `SwappableStorage` contract is initialized with a new Signer Server address and potentially a new price
3. current `SwappableStorage` address gets set to a new `SwappableStorage` address
4. `Biomapper` contract invokes the `initGeneration` function of `BiomapperLog` contract

#### **`BiomapperLog` contract**

Upon receiving `initGeneration` call from the `Biomapper` contract, `BiomapperLog` initializes a new `Generation` struct and adds it into the generations doubly linked list.

## Preparation and actual generation change

The actual generation change encompasses steps 3 and 4 of the Biomapper contract, along with a call to the BiomapperLog contract. These actions are bundled into a single transaction.

The preparation stage encompasses all other aspects, including CVM, signer server, and swappable storage. These steps, especially CVM deployment, can be time-consuming.

This division is primarily necessary to minimize the time window required for the update.
